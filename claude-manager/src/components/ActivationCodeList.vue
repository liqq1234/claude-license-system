<template>
    <div class="activation-code-list">
        <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâÊ†è -->
        <div class="search-bar">
            <el-input
                v-model="searchText"
                placeholder="ÊêúÁ¥¢ÊøÄÊ¥ªÁ†ÅÊàñÊèèËø∞"
                style="width: 300px; margin-right: 10px"
                clearable
                @input="handleSearch"
            >
                <template #prefix>
                    <el-icon>
                        <Search />
                    </el-icon>
                </template>
            </el-input>

            <el-select
                v-model="statusFilter"
                placeholder="Áä∂ÊÄÅÁ≠õÈÄâ"
                style="width: 150px"
                clearable
                @change="handleSearch"
            >
                <el-option label="ÂÖ®ÈÉ®" value />
                <el-option label="Êú™‰ΩøÁî®" value="unused" />
                <el-option label="Â∑≤‰ΩøÁî®" value="used" />
                <el-option label="Â∑≤ÊøÄÊ¥ª" value="activated" />
                <el-option label="Â∑≤ËøáÊúü" value="expired" />
                <el-option label="Â∑≤ÊöÇÂÅú" value="suspended" />
                <el-option label="Â∑≤Á¶ÅÁî®" value="disabled" />
            </el-select>
        </div>

        <!-- ÊøÄÊ¥ªÁ†ÅË°®Ê†º -->
        <el-table :data="codes" v-loading="loading" stripe style="width: 100%" height="600">
            <el-table-column prop="code" label="ÊøÄÊ¥ªÁ†Å" width="200" fixed>
                <template #default="{ row }">
                    <div class="code-cell">
                        <span class="code-text">{{ row.code }}</span>
                        <el-button
                            size="small"
                            text
                            @click="copyCode(row.code)"
                            :icon="DocumentCopy"
                        />
                    </div>
                </template>
            </el-table-column>

            <el-table-column prop="type" label="Á±ªÂûã" width="100">
                <template #default="{ row }">
                    <el-tag :type="getTypeColor(row.type)" size="small">{{ getTypeText(row.type) }}</el-tag>
                </template>
            </el-table-column>

            <el-table-column prop="status" label="Áä∂ÊÄÅ" width="100">
                <template #default="{ row }">
                    <el-tag
                        :type="getStatusType(row.status)"
                        size="small"
                    >{{ getStatusText(row.status) }}</el-tag>
                </template>
            </el-table-column>

            <el-table-column prop="description" label="ÊèèËø∞" min-width="120" show-overflow-tooltip />

            <el-table-column prop="createdAt" label="ÂàõÂª∫Êó∂Èó¥" width="140">
                <template #default="{ row }">
                    <span v-if="row.createdAt">{{ formatDate(row.createdAt) }}</span>
                    <span v-else class="no-data">Êú™ËÆ∞ÂΩï</span>
                </template>
            </el-table-column>

            <el-table-column prop="expiresAt" label="ËøáÊúüÊó∂Èó¥" width="140">
                <template #default="{ row }">
                    <span v-if="row.expiresAt && row.expiresAt !== null">
                        <span v-if="isExpired(row)" class="expired-text">Â∑≤ËøáÊúü</span>
                        <span v-else>{{ formatDate(row.expiresAt) }}</span>
                    </span>
                    <span v-else class="no-expire">-</span>
                </template>
            </el-table-column>

            <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
                <template #default="{ row }">
                    <el-button size="small" @click="viewDetails(row)">ËØ¶ÊÉÖ</el-button>
                    <!-- Â∑≤ÊøÄÊ¥ªÁöÑÂè™ËÉΩÊöÇÂÅú -->
                    <el-button
                        v-if="(row.status === 'used' || row.status === 'activated') && row.status !== 'suspended'"
                        size="small"
                        type="warning"
                        @click="suspendCode(row)"
                    >ÊöÇÂÅú</el-button>
                    <!-- Â∑≤ÊöÇÂÅúÁöÑÂèØ‰ª•ÊÅ¢Â§ç -->
                    <el-button
                        v-if="row.status === 'suspended'"
                        size="small"
                        type="success"
                        @click="resumeCode(row)"
                    >ÊÅ¢Â§ç</el-button>
                    <!-- Êú™ÊøÄÊ¥ª„ÄÅÂ∑≤ËøáÊúüÁöÑÂèØ‰ª•Âà†Èô§ÔºåÂ∑≤ÊöÇÂÅúÁöÑ‰πüÂèØ‰ª•Âà†Èô§ -->
                    <el-button
                        v-if="row.status === 'unused' || row.status === 'expired' || row.status === 'suspended' || (row.expiresAt && isExpired(row))"
                        size="small"
                        type="danger"
                        @click="deleteCode(row)"
                    >Âà†Èô§</el-button>
                </template>
            </el-table-column>
        </el-table>

        <!-- ÂàÜÈ°µ -->
        <div class="pagination-wrapper">
            <el-pagination
                :current-page="currentPage"
                :page-size="pageSize"
                :page-sizes="[10, 20, 50, 100]"
                :total="totalCount"
                layout="total, sizes, prev, pager, next, jumper"
                @current-change="handleCurrentChange"
                @size-change="handleSizeChange"
            />
        </div>

        <!-- ËØ¶ÊÉÖÂºπÁ™ó -->
        <el-dialog
            v-model="detailDialogVisible"
            title="ÊøÄÊ¥ªÁ†ÅËØ¶ÊÉÖ"
            width="900px"
            :close-on-click-modal="false"
        >
            <div v-if="selectedCode" class="code-details">
                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="detail-section">
                    <h4 class="section-title">üîë Âü∫Êú¨‰ø°ÊÅØ</h4>
                    <el-descriptions :column="2" border size="small">
                        <el-descriptions-item label="ÊøÄÊ¥ªÁ†Å">
                            <div class="code-display">
                                <span class="code-text">{{ selectedCode.code }}</span>
                                <el-button
                                    size="small"
                                    text
                                    @click="copyCode(selectedCode.code)"
                                    :icon="DocumentCopy"
                                />
                            </div>
                        </el-descriptions-item>
                        <el-descriptions-item label="Á±ªÂûã">
                            <el-tag
                                :type="getTypeColor(selectedCode.type)"
                                size="small"
                            >{{ getTypeText(selectedCode.type) }}</el-tag>
                        </el-descriptions-item>
                        <el-descriptions-item label="Áä∂ÊÄÅ">
                            <el-tag
                                :type="getStatusType(selectedCode.status)"
                                size="small"
                            >{{ getStatusText(selectedCode.status) }}</el-tag>
                        </el-descriptions-item>
                        <el-descriptions-item label="ÊåÅÁª≠Êó∂Èó¥">
                            <span v-if="selectedCode.duration">{{ selectedCode.duration }} Â∞èÊó∂</span>
                            <span v-else class="permanent-text">Ê∞∏‰πÖ</span>
                        </el-descriptions-item>
                    </el-descriptions>
                </div>

                <!-- ËÆæÂ§á‰ø°ÊÅØ -->
                <div class="detail-section">
                    <h4 class="section-title">üì± ËÆæÂ§á‰ø°ÊÅØ</h4>
                    <el-descriptions :column="2" border size="small">
                        <el-descriptions-item label="ÊúÄÂ§ßËÆæÂ§áÊï∞">
                            <span class="number-text">{{ selectedCode.maxDevices || 1 }}</span>
                        </el-descriptions-item>
                        <el-descriptions-item label="Â∑≤‰ΩøÁî®ËÆæÂ§á">
                            <span class="number-text">{{ selectedCode.usedCount || 0 }}</span>
                        </el-descriptions-item>
                    </el-descriptions>
                </div>

                <!-- Êó∂Èó¥‰ø°ÊÅØ -->
                <div class="detail-section">
                    <h4 class="section-title">‚è∞ Êó∂Èó¥‰ø°ÊÅØ</h4>
                    <el-descriptions :column="2" border size="small">
                        <el-descriptions-item label="ÂàõÂª∫Êó∂Èó¥">
                            <span
                                v-if="selectedCode.createdAt"
                            >{{ formatDate(selectedCode.createdAt) }}</span>
                            <span v-else class="no-data">Êú™ËÆ∞ÂΩï</span>
                        </el-descriptions-item>
                        <el-descriptions-item label="ËøáÊúüÊó∂Èó¥">
                            <span v-if="selectedCode.expiresAt && selectedCode.expiresAt !== null">
                                <span v-if="isExpired(selectedCode)" class="expired-text">Â∑≤ËøáÊúü</span>
                                <span v-else>{{ formatDate(selectedCode.expiresAt) }}</span>
                            </span>
                            <span v-else class="no-expire">-</span>
                        </el-descriptions-item>
                    </el-descriptions>
                </div>

                <!-- ÊâπÊ¨°‰ø°ÊÅØ -->
                <div class="detail-section" v-if="selectedCode.batch || selectedCode.batchId">
                    <h4 class="section-title">üì¶ ÊâπÊ¨°‰ø°ÊÅØ</h4>
                    <el-descriptions :column="1" border size="small">
                        <el-descriptions-item label="ÊâπÊ¨°ID">{{ selectedCode.batchId || 'Êó†' }}</el-descriptions-item>
                        <el-descriptions-item
                            label="ÊâπÊ¨°ÂêçÁß∞"
                            v-if="selectedCode.batch?.name"
                        >{{ selectedCode.batch.name }}</el-descriptions-item>
                        <el-descriptions-item
                            label="ÊâπÊ¨°ÊèèËø∞"
                            v-if="selectedCode.batch?.description"
                        >{{ selectedCode.batch.description }}</el-descriptions-item>
                    </el-descriptions>
                </div>

                <!-- Êâ©Â±ï‰ø°ÊÅØ -->
                <div class="detail-section">
                    <h4 class="section-title">üìù Êâ©Â±ï‰ø°ÊÅØ</h4>
                    <el-descriptions :column="1" border size="small">
                        <el-descriptions-item label="ÊèèËø∞">{{ selectedCode.description || 'Êó†ÊèèËø∞' }}</el-descriptions-item>
                        <el-descriptions-item
                            label="Ê†áÁ≠æ"
                            v-if="selectedCode.tags && selectedCode.tags.length"
                        >
                            <div class="tags-container">
                                <el-tag
                                    v-for="tag in selectedCode.tags"
                                    :key="tag"
                                    size="small"
                                    class="tag-item"
                                >{{ tag }}</el-tag>
                            </div>
                        </el-descriptions-item>
                        <el-descriptions-item
                            label="ÊùÉÈôê"
                            v-if="selectedCode.permissions && selectedCode.permissions.length"
                        >
                            <div class="permissions-container">
                                <el-tag
                                    v-for="permission in selectedCode.permissions"
                                    :key="permission"
                                    type="success"
                                    size="small"
                                    class="permission-item"
                                >{{ permission }}</el-tag>
                            </div>
                        </el-descriptions-item>
                    </el-descriptions>
                </div>

                <!-- ËÆæÂ§áÁªëÂÆö‰ø°ÊÅØ -->
                <div
                    v-if="selectedCode.deviceBindings && selectedCode.deviceBindings.length"
                    class="device-bindings"
                >
                    <h4>ËÆæÂ§áÁªëÂÆö‰ø°ÊÅØ</h4>
                    <el-table :data="selectedCode.deviceBindings" size="small">
                        <el-table-column prop="deviceId" label="ËÆæÂ§áID" />
                        <el-table-column prop="activatedAt" label="ÊøÄÊ¥ªÊó∂Èó¥">
                            <template #default="{ row }">{{ formatDate(row.activatedAt) }}</template>
                        </el-table-column>
                        <el-table-column prop="lastSeenAt" label="ÊúÄÂêéÊ¥ªË∑É">
                            <template #default="{ row }">{{ formatDate(row.lastSeenAt) }}</template>
                        </el-table-column>
                        <el-table-column prop="status" label="Áä∂ÊÄÅ">
                            <template #default="{ row }">
                                <el-tag
                                    :type="row.status === 'active' ? 'success' : 'warning'"
                                    size="small"
                                >{{ row.status === 'active' ? 'Ê¥ªË∑É' : 'Á¶ªÁ∫ø' }}</el-tag>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </div>

            <template #footer>
                <el-button @click="detailDialogVisible = false">ÂÖ≥Èó≠</el-button>
            </template>
        </el-dialog>
    </div>
</template>

<script setup>
import { ref, onMounted } from "vue";
import { ElMessage, ElMessageBox } from "element-plus";
import { DocumentCopy } from "@element-plus/icons-vue";
import { activationApi } from "../api/activation.js";

const props = defineProps({
    loading: {
        type: Boolean,
        default: false,
    },
});

const emit = defineEmits(["refresh"]);

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const searchText = ref("");
const statusFilter = ref("");
const currentPage = ref(1);
const pageSize = ref(20);
const codes = ref([]);
const totalCount = ref(0);
const loading = ref(false);
const detailDialogVisible = ref(false);
const selectedCode = ref(null);

// ËÆ°ÁÆóÂ±ûÊÄß - Áé∞Âú®‰ΩøÁî®ÊúçÂä°Âô®Á´ØÂàÜÈ°µÂíåÁ≠õÈÄâÔºå‰∏çÈúÄË¶ÅÂÆ¢Êà∑Á´ØÂ§ÑÁêÜ

// ÊñπÊ≥ï
const loadCodes = async () => {
    loading.value = true;
    try {
        const params = {
            page: currentPage.value,
            limit: pageSize.value,
            status: statusFilter.value || undefined,
            search: searchText.value || undefined,
        };

        const response = await activationApi.getCodes(params);
        
        // ÂêéÁ´ØÂÆûÈôÖËøîÂõûÁªìÊûÑ: {status: 0, codes: [...], total: 17, page: 1, limit: 20}
        if (response && response.status === 0) {
            codes.value = response.codes || [];
            totalCount.value = response.total || 0;
        } else {
            codes.value = [];
            totalCount.value = 0;
            ElMessage.warning("Ëé∑ÂèñÊøÄÊ¥ªÁ†ÅÂàóË°®Â§±Ë¥•");
        }
    } catch (error) {
        console.error("Âä†ËΩΩÊøÄÊ¥ªÁ†ÅÂàóË°®Â§±Ë¥•:", error);
        ElMessage.error("Âä†ËΩΩÊøÄÊ¥ªÁ†ÅÂàóË°®Â§±Ë¥•: " + (error.message || "ÁΩëÁªúÈîôËØØ"));
        codes.value = [];
        totalCount.value = 0;
    } finally {
        loading.value = false;
    }
};

const handleSearch = () => {
    currentPage.value = 1;
    loadCodes();
};

const handleSizeChange = (val) => {
    pageSize.value = val;
    currentPage.value = 1;
    loadCodes();
};

const handleCurrentChange = (val) => {
    currentPage.value = val;
    loadCodes();
};

const copyCode = async (code) => {
    try {
        await navigator.clipboard.writeText(code);
        ElMessage.success("ÊøÄÊ¥ªÁ†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø");
    } catch (error) {
        ElMessage.error("Â§çÂà∂Â§±Ë¥•");
    }
};

const viewDetails = async (row) => {
    try {
        const response = await activationApi.getCodeDetails(row.code);

        if (
            response.data &&
            response.data.status === 0 &&
            response.data.data &&
            response.data.data.status === 0
        ) {
            // APIÊàêÂäüËøîÂõûÊï∞ÊçÆ
            let codeData = response.data.data.data || response.data.data || row;

            // Â§ÑÁêÜtagsÂ≠óÊÆµÔºåÂ¶ÇÊûúÊòØJSONÂ≠óÁ¨¶‰∏≤ÂàôËß£Êûê‰∏∫Êï∞ÁªÑ
            if (codeData.tags && typeof codeData.tags === "string") {
                try {
                    codeData.tags = JSON.parse(codeData.tags);
                } catch (e) {
                    console.warn("Ëß£ÊûêtagsÂ§±Ë¥•:", e);
                    codeData.tags = [];
                }
            }

            // Â§ÑÁêÜpermissionsÂ≠óÊÆµÔºåÂ¶ÇÊûúÊòØJSONÂ≠óÁ¨¶‰∏≤ÂàôËß£Êûê‰∏∫Êï∞ÁªÑ
            if (
                codeData.permissions &&
                typeof codeData.permissions === "string"
            ) {
                try {
                    codeData.permissions = JSON.parse(codeData.permissions);
                } catch (e) {
                    console.warn("Ëß£ÊûêpermissionsÂ§±Ë¥•:", e);
                    codeData.permissions = [];
                }
            }

            selectedCode.value = codeData;
        } else {
            // APIËøîÂõûÈîôËØØÔºå‰ΩøÁî®ÂàóË°®‰∏≠ÁöÑÊï∞ÊçÆÂπ∂ËøõË°åÊï∞ÊçÆÂ§ÑÁêÜ
            selectedCode.value = processRowData(row);
        }
        detailDialogVisible.value = true;
    } catch (error) {
        console.error("Ëé∑ÂèñÊøÄÊ¥ªÁ†ÅËØ¶ÊÉÖÂ§±Ë¥•:", error);
        // ÂèëÁîüÈîôËØØÊó∂Ôºå‰ΩøÁî®ÂàóË°®‰∏≠ÁöÑÊï∞ÊçÆÂπ∂ËøõË°åÂ§ÑÁêÜ
        selectedCode.value = processRowData(row);
        detailDialogVisible.value = true;
        ElMessage.warning("Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØÂ§±Ë¥•ÔºåÊòæÁ§∫Âü∫Êú¨‰ø°ÊÅØ");
    }
};

// Â§ÑÁêÜÂàóË°®Ë°åÊï∞ÊçÆÔºåÁ°Æ‰øùÊ†ºÂºèÊ≠£Á°Æ
const processRowData = (row) => {
    let processedData = { ...row };

    // Â§ÑÁêÜtagsÂ≠óÊÆµ
    if (processedData.tags && typeof processedData.tags === "string") {
        try {
            processedData.tags = JSON.parse(processedData.tags);
        } catch (e) {
            console.warn("Ëß£ÊûêtagsÂ§±Ë¥•:", e);
            processedData.tags = [];
        }
    }

    // Â§ÑÁêÜpermissionsÂ≠óÊÆµ
    if (
        processedData.permissions &&
        typeof processedData.permissions === "string"
    ) {
        try {
            processedData.permissions = JSON.parse(processedData.permissions);
        } catch (e) {
            console.warn("Ëß£ÊûêpermissionsÂ§±Ë¥•:", e);
            processedData.permissions = [];
        }
    }

    // Á°Æ‰øùÂøÖË¶ÅÂ≠óÊÆµÂ≠òÂú®
    if (!processedData.batch && processedData.batchId) {
        processedData.batch = {
            id: processedData.batchId,
            name: processedData.batchId,
            description: "ÊâπÊ¨°‰ø°ÊÅØ",
        };
    }

    return processedData;
};

const suspendCode = async (row) => {
    try {
        await ElMessageBox.confirm(
            `Á°ÆÂÆöË¶ÅÊöÇÂÅúÊøÄÊ¥ªÁ†Å ${row.code} ÂêóÔºü`,
            "Á°ÆËÆ§ÊöÇÂÅú",
            {
                confirmButtonText: "Á°ÆÂÆö",
                cancelButtonText: "ÂèñÊ∂à",
                type: "warning",
            }
        );

        await activationApi.suspendCode(row.code, { reason: "ÁÆ°ÁêÜÂëòÊâãÂä®ÊöÇÂÅú" });
        ElMessage.success("ÊøÄÊ¥ªÁ†ÅÂ∑≤ÊöÇÂÅú");
        // Âà∑Êñ∞ÂàóË°®Êï∞ÊçÆ
        loadCodes();
        emit("refresh");
    } catch (error) {
        if (error !== "cancel") {
            ElMessage.error("ÊöÇÂÅúÂ§±Ë¥•: " + (error.message || error));
        }
    }
};

const resumeCode = async (row) => {
    try {
        await ElMessageBox.confirm(
            `Á°ÆÂÆöË¶ÅÊÅ¢Â§çÊøÄÊ¥ªÁ†Å ${row.code} ÂêóÔºü`,
            "Á°ÆËÆ§ÊÅ¢Â§ç",
            {
                confirmButtonText: "Á°ÆÂÆö",
                cancelButtonText: "ÂèñÊ∂à",
                type: "warning",
            }
        );

        await activationApi.resumeCode(row.code);
        ElMessage.success("ÊøÄÊ¥ªÁ†ÅÂ∑≤ÊÅ¢Â§ç");
        // Âà∑Êñ∞ÂàóË°®Êï∞ÊçÆ
        loadCodes();
        emit("refresh");
    } catch (error) {
        if (error !== "cancel") {
            ElMessage.error("ÊÅ¢Â§çÂ§±Ë¥•: " + (error.message || error));
        }
    }
};

const deleteCode = async (row) => {
    try {
        await ElMessageBox.confirm(
            `Á°ÆÂÆöË¶ÅÂà†Èô§ÊøÄÊ¥ªÁ†Å ${row.code} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,
            "Á°ÆËÆ§Âà†Èô§",
            {
                confirmButtonText: "Á°ÆÂÆö",
                cancelButtonText: "ÂèñÊ∂à",
                type: "warning",
            }
        );

        await activationApi.deleteCode(row.code);
        ElMessage.success("ÊøÄÊ¥ªÁ†ÅÂ∑≤Âà†Èô§");
        // Âà∑Êñ∞ÂàóË°®Êï∞ÊçÆ
        loadCodes();
        emit("refresh");
    } catch (error) {
        if (error !== "cancel") {
            ElMessage.error("Âà†Èô§Â§±Ë¥•: " + (error.message || error));
        }
    }
};

const getTypeText = (type) => {
    const types = {
        daily: "Êó•Âç°",
        weekly: "Âë®Âç°",
        monthly: "ÊúàÂç°",
        yearly: "Âπ¥Âç°",
        permanent: "Ê∞∏‰πÖÂç°",
    };
    return types[type] || type;
};

const getTypeColor = (type) => {
    const colors = {
        daily: "warning", // Ê©ôËâ≤ - Êó•Âç°
        weekly: "info", // ËìùËâ≤ - Âë®Âç°
        monthly: "success", // ÁªøËâ≤ - ÊúàÂç°
        yearly: "danger", // Á∫¢Ëâ≤ - Âπ¥Âç°
        permanent: "", // ÈªòËÆ§Ëâ≤ - Ê∞∏‰πÖÂç°
    };
    return colors[type] || "";
};

const getStatusType = (status) => {
    const types = {
        unused: "",
        used: "success",
        activated: "success",
        expired: "warning",
        suspended: "danger",
        disabled: "info",
    };
    return types[status] || "";
};

const getStatusText = (status) => {
    const texts = {
        unused: "Êú™‰ΩøÁî®",
        used: "Â∑≤‰ΩøÁî®",
        activated: "Â∑≤ÊøÄÊ¥ª",
        expired: "Â∑≤ËøáÊúü",
        suspended: "Â∑≤ÊöÇÂÅú",
        disabled: "Â∑≤Á¶ÅÁî®",
    };
    return texts[status] || status;
};

const isExpired = (row) => {
    if (!row.expiresAt) return false;

    // Â§ÑÁêÜÊó∂Èó¥Êà≥ÔºàÊØ´ÁßíÔºâ
    let expiresDate;
    if (typeof row.expiresAt === "number") {
        expiresDate = new Date(row.expiresAt);
    } else {
        expiresDate = new Date(row.expiresAt);
    }

    // Ê£ÄÊü•Êó•ÊúüÊòØÂê¶ÊúâÊïà
    if (isNaN(expiresDate.getTime())) {
        return false;
    }

    return expiresDate < new Date();
};

const formatDate = (dateString) => {
    if (!dateString) return "-";

    // Â§ÑÁêÜÊó∂Èó¥Êà≥ÔºàÊØ´ÁßíÔºâ
    let date;
    if (typeof dateString === "number") {
        date = new Date(dateString);
    } else {
        date = new Date(dateString);
    }

    // Ê£ÄÊü•Êó•ÊúüÊòØÂê¶ÊúâÊïà
    if (isNaN(date.getTime())) {
        return "-";
    }

    return date.toLocaleString("zh-CN", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
    });
};

// ÁîüÂëΩÂë®Êúü
onMounted(() => {
    loadCodes();
});

// Êö¥Èú≤ÊñπÊ≥ïÁªôÁà∂ÁªÑ‰ª∂
defineExpose({
    loadCodes,
});
</script>

<style scoped>
.activation-code-list {
    padding: 0;
}

.search-bar {
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.code-cell {
    display: flex;
    align-items: center;
    gap: 8px;
}

.code-text {
    font-family: "Courier New", monospace;
    font-size: 12px;
    color: #409eff;
}

.pagination-wrapper {
    margin-top: 20px;
    display: flex;
    justify-content: center;
}

/* ËØ¶ÊÉÖÂºπÁ™óÊ†∑Âºè */
.code-details {
    max-height: 600px;
    overflow-y: auto;
}

.device-bindings {
    margin-top: 20px;
}

.device-bindings h4 {
    margin: 0 0 15px 0;
    color: #303133;
    font-size: 16px;
    font-weight: 600;
}

/* ËøáÊúüÊó∂Èó¥Ê†∑Âºè */
.no-expire {
    color: #67c23a;
    font-weight: 500;
    font-size: 12px;
}

.expired-text {
    color: #f56c6c;
    font-weight: 500;
    font-size: 12px;
}

.no-data {
    color: #c0c4cc;
    font-style: italic;
    font-size: 12px;
}

/* ÊâπÊ¨°‰ø°ÊÅØÊ†∑Âºè */
.batch-info {
    line-height: 1.6;
}

.batch-info div {
    margin-bottom: 4px;
}

.batch-info strong {
    color: #303133;
    margin-right: 8px;
}

/* ËØ¶ÊÉÖÂºπÁ™óÊ†∑Âºè‰ºòÂåñ */
.detail-section {
    margin-bottom: 20px;
}

.section-title {
    margin: 0 0 12px 0;
    color: #303133;
    font-size: 16px;
    font-weight: 600;
    padding-bottom: 8px;
    border-bottom: 2px solid #f0f0f0;
}

.code-display {
    display: flex;
    align-items: center;
    gap: 8px;
}

.permanent-text {
    color: #909399;
    font-weight: 500;
}

.number-text {
    color: #409eff;
    font-weight: 600;
}

.tags-container,
.permissions-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.tag-item,
.permission-item {
    margin: 0;
}
</style>