# Token 有效期配置说明

## 🔧 当前配置

```bash
TOKEN_EXPIRES_IN=86400  # 24小时 = 86400秒
```

## ⏰ 有效期机制

### 1. 默认行为
- **用户不指定有效期**：使用系统默认值 24 小时
- **用户指定有效期**：使用用户指定的值
- **超出系统限制**：显示警告但仍使用用户指定的值

### 2. 警告机制
当用户指定的有效期超过系统默认值时，会显示：
```
"会话有效期已设置为 X 小时，超过系统默认的 24 小时"
```

### 3. 实际效果

#### 场景1：用户不指定有效期
```javascript
// 前端请求
{
  "mode": "specific",
  "email": "user@example.com"
  // 没有 expires_in 参数
}

// 实际使用：24小时
// 用户体验：会话在24小时后自动过期
```

#### 场景2：用户指定较短有效期
```javascript
// 前端请求
{
  "mode": "specific", 
  "email": "user@example.com",
  "expires_in": 3600  // 1小时
}

// 实际使用：1小时
// 用户体验：会话在1小时后过期，无警告
```

#### 场景3：用户指定较长有效期
```javascript
// 前端请求
{
  "mode": "specific",
  "email": "user@example.com", 
  "expires_in": 172800  // 48小时
}

// 实际使用：48小时
// 用户体验：会话在48小时后过期，显示警告
```

## 📊 常用时间换算

```bash
# 1小时
expires_in: 3600

# 6小时  
expires_in: 21600

# 12小时
expires_in: 43200

# 24小时（当前默认）
expires_in: 86400

# 48小时
expires_in: 172800

# 7天
expires_in: 604800
```

## 🎯 推荐使用场景

### 24小时设置的优势
1. **安全性**：定期过期减少安全风险
2. **资源管理**：避免僵尸会话占用资源
3. **用户习惯**：符合日常使用模式
4. **系统稳定**：减少长期会话可能的问题

### 适合的用户群体
- 日常办公用户
- 学习研究用户
- 临时访问用户

## 🔄 重启服务生效

修改配置后需要重启后端服务：

```bash
# 停止服务
pm2 stop claude-pool-backend

# 重启服务  
pm2 start claude-pool-backend

# 或者重新加载
pm2 reload claude-pool-backend
```

## 📝 日志记录

系统会记录每次登录的有效期设置：

```javascript
// 数据库记录
{
  account_id: 123,
  email: "user@example.com",
  expires_in: 86400,  // 实际使用的有效期
  success: true
}
```

## ⚠️ 注意事项

1. **会话中断**：即使设置了24小时，会话仍可能因为其他原因中断
2. **重新登录**：会话过期后用户需要重新点击登录
3. **浏览器依赖**：用户清除浏览器数据会导致会话丢失
4. **服务器重启**：Claude 服务器重启会清除所有会话

## 🔧 故障排除

### 问题：用户反馈会话过期太快
**解决方案：** 可以适当延长默认时间，如设置为48小时

### 问题：系统资源占用过高
**解决方案：** 可以缩短默认时间，如设置为12小时

### 问题：安全性要求更高
**解决方案：** 可以设置更短时间，如6小时或8小时
