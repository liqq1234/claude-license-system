"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6147],{6568:(e,t,n)=>{n.d(t,{ED:()=>l,SL:()=>a,fO:()=>o,n2:()=>u,tA:()=>d});var i=n(96784);n(27062);var r=n(7620);let u=e=>2e3*e.document_asset.page_count,a=e=>Math.min(1600,Math.ceil(e.preview_asset.image_width*e.preview_asset.image_height/700)),l=e=>e.reduce((e,t)=>e+a(t),0),o=(e,t,n)=>{let u=(0,i.F)(e),a=(0,r.useMemo)(()=>n.map(e=>e.extracted_content).join(" "),[n]);return u+(0,i.F)(a)+l(t)},d=(e,t)=>e/t>.4},33703:(e,t,n)=>{n.d(t,{CC:()=>s,Fo:()=>d,HP:()=>c,Zi:()=>v});var i=n(77186),r=n(1761),u=n(29585),a=n(71473),l=n(87606),o=n(81527);let d=(e,t)=>{let{account:n,activeOrganization:u}=(0,r.YL)(),d=t===(null==n?void 0:n.uuid),c=null==u?void 0:u.uuid,s=(0,l.useQueryClient)(),v=(0,o.Gz)();return(0,i.L2)(()=>"/api/organizations/".concat(c,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[a.vE,{projectUuid:e}]}),d&&(v(e),s.invalidateQueries({queryKey:[a.A2,{orgUUID:c}]}),s.invalidateQueries({queryKey:[a.DC,{orgUUID:c}]}),s.invalidateQueries({queryKey:[a.Ad,{orgUUID:c}]}))}})},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),l=null==n?void 0:n.uuid;return(0,i.Sk)("/api/organizations/".concat(l,"/projects/").concat(e,"/accounts"),{queryKey:[a.vE,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0,meta:{noToast:e=>e instanceof u.LG&&403===e.statusCode}})},s=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,u=(0,l.useQueryClient)();return(0,i.L2)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{u.invalidateQueries({queryKey:[a.vE,{projectUuid:e}]})},transformVariables:e=>({role:e.role})})},v=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,u=(0,l.useQueryClient)();return(0,i.L2)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts_bulk"),"POST",{onSuccess(){u.invalidateQueries({queryKey:[a.vE,{projectUuid:e}]})}})}},41932:(e,t,n)=>{n.d(t,{Aw:()=>v,KU:()=>p,MO:()=>o,Rn:()=>d,fh:()=>c,gG:()=>s,uE:()=>y});var i=n(77186),r=n(1761),u=n(29585),a=n(71473),l=n(87606);function o(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),u=null==n?void 0:n.uuid,{data:l,...o}=(0,i.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/docs"),{queryKey:[a.cC,{orgUuid:u,projectUuid:e}],enabled:!!n&&!!e&&t});return{data:null==l?void 0:l.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return"[ANT ONLY] synced_resources.txt"!==t}),unfilteredData:l,...o}}let d=e=>{let{projectUuid:t,docUuid:n}=e,{activeOrganization:l}=(0,r.YL)(),o=null==l?void 0:l.uuid;return(0,i.Sk)("/api/organizations/".concat(o,"/projects/").concat(t,"/docs/").concat(n),{queryKey:[a.Db,{orgUuid:o,projectUuid:t,docUuid:n}],enabled:!!l,staleTime:0,meta:{noToast:e=>e instanceof u.LG&&404===e.statusCode}})};function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,r.YL)(),u=null==n?void 0:n.uuid,o=(0,l.useQueryClient)();return(0,i.L2)(()=>"/api/organizations/".concat(u,"/projects/").concat(e,"/docs"),"POST",{enabled:!!e,onSuccess:function(){for(var n,i=arguments.length,r=Array(i),l=0;l<i;l++)r[l]=arguments[l];o.invalidateQueries({queryKey:[a.cC,{orgUuid:u,projectUuid:e}]}),o.invalidateQueries({queryKey:[a.A2,{orgUUID:u}]}),o.invalidateQueries({queryKey:[a.qz,{orgUuid:u,projectUuid:e}]}),null==(n=t.onSuccess)||n.call(t,...r)},onError:function(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];null==(e=t.onError)||e.call(t,...i)}})}function s(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,u=(0,l.useQueryClient)();return(0,i.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[a.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,i)=>{u.invalidateQueries({queryKey:[a.Db,{orgUuid:n,projectUuid:e,docUuid:i.docUuid}]}),u.invalidateQueries({queryKey:[a.A2,{orgUUID:n}]}),u.invalidateQueries({queryKey:[a.qz,{orgUuid:n,projectUuid:e}]})},onError:()=>{u.invalidateQueries({queryKey:[a.cC,{orgUuid:n,projectUuid:e}]})}})}let v=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,u=(0,l.useQueryClient)();return(0,i.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[a.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,i)=>{for(let t of i.doc_uuids)u.invalidateQueries({queryKey:[a.Db,{orgUuid:n,projectUuid:e,docUuid:t}]});u.invalidateQueries({queryKey:[a.cC,{orgUuid:n,projectUuid:e}]}),u.invalidateQueries({queryKey:[a.A2,{orgUUID:n}]}),u.invalidateQueries({queryKey:[a.qz,{orgUuid:n,projectUuid:e}]})}})};function p(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,u=(0,l.useQueryClient)();return(0,i.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[a.mw,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:()=>{u.invalidateQueries({queryKey:[a.A2,{orgUUID:n}]}),u.invalidateQueries({queryKey:[a.qz,{orgUuid:n,projectUuid:e}]})},onError:()=>{u.invalidateQueries({queryKey:[a.mw,{orgUuid:n,projectUuid:e}]})}})}function y(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),u=null==n?void 0:n.uuid;return(0,i.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/files"),{queryKey:[a.mw,{orgUuid:u,projectUuid:e}],enabled:!!n&&!!e&&t})}},56147:(e,t,n)=>{n.d(t,{AO:()=>Q,AV:()=>C,ED:()=>T,Pb:()=>z,RP:()=>j,aT:()=>q,gq:()=>E,pb:()=>k,ti:()=>U});var i=n(85644),r=n(96784),u=n(1761),a=n(55554),l=n(46612),o=n(27062),d=n(77101),c=n(85544),s=n(7620),v=n(75006),p=n(98251),y=n(33703),f=n(41932),m=n(52909),_=n(81527),g=n(6568),L=n(80731);let h={hardLimit:1e5},S={default:{max:h,raven:h,pro:h,free:h}},b=v.z.object({hardLimit:v.z.number().optional(),tokensPerImage:v.z.number().optional()}),K=v.z.object({free:b.optional(),pro:b.optional(),raven:b.optional(),max:b.optional()}),j=v.z.record(K.optional()),q=()=>{let{data:e}=(0,_.PL)(),t=(0,L.p)();return void 0!==t&&void 0!==e&&e.count>=t},C=()=>{let{value:e}=(0,o.fS)("claude_ai_project_bananagrams");return e},z=e=>{let t=C(),{data:n}=(0,p.fR)(e,t);return!!t&&(void 0!==n?!!(t&&n.use_project_knowledge_search):void 0)},Q=()=>{let e=(0,u.mV)(),t=(0,u.O9)(),n=(0,u.zc)(),{selectedTier:r,shouldOverrideTokenLimits:l,isTierSelectorEnabled:d}=(0,a.t)(),s=d&&l&&!!r,v=(0,o.T9)("console_default_model","model",null,o.Lu),{activeModelOptions:p}=(0,i.A9)(),y=p.map(e=>e.model),f=(0,o.iW)("hatch_token_limits",S,j),m=C(),_=(0,o.T9)("project_knowledge_limit","limit",0x3200000,o.T2);if(m)return{maxKbTokens:_,modelWithLargestContext:null};let g=null,L=-1/0;for(let i of Object.keys(f)){var h,b,K,q,z,Q,T,E,k,U,P,w,Y,D,R,O;let u,a;if(!y.includes(i)&&"default"!==i)continue;let l=f[i];(s?r===c.d7.MAX:n)?(u=null!=(K=null==l||null==(h=l.max)?void 0:h.hardLimit)?K:19e4,a=null!=(q=null==l||null==(b=l.max)?void 0:b.output)?q:8192):(s?r===c.d7.ENTERPRISE:e)?(u=null!=(T=null==l||null==(z=l.raven)?void 0:z.hardLimit)?T:19e4,a=null!=(E=null==l||null==(Q=l.raven)?void 0:Q.output)?E:8192):(s?r===c.d7.PRO:t)?(u=null!=(P=null==l||null==(k=l.pro)?void 0:k.hardLimit)?P:19e4,a=null!=(w=null==l||null==(U=l.pro)?void 0:U.output)?w:8192):(u=null!=(R=null==l||null==(Y=l.free)?void 0:Y.hardLimit)?R:25e3,a=null!=(O=null==l||null==(D=l.free)?void 0:D.output)?O:8192),(u=Math.round(.9*u)-a)>L?(g="default"===i?v:i,L=u):u===L&&"default"===i&&(g=v)}return{maxKbTokens:L,modelWithLargestContext:g}},T=e=>{let t=C(),{data:n,isLoading:i}=(0,f.MO)(e,!1===t),{data:u,isLoading:a}=(0,m.CO)(e,!0,!1===t),{data:o,isLoading:c}=(0,f.uE)(e,!1===t),{data:v,isLoading:y}=(0,p.fR)(e,t),_=null==o?void 0:o.filter(e=>"document"===e.file_kind),L=(0,s.useMemo)(()=>{var e;return null!=(e=null==_?void 0:_.reduce((e,t)=>e+(0,g.n2)(t),0))?e:0},[_]),h=null==o?void 0:o.filter(e=>"image"===e.file_kind),S=(0,s.useMemo)(()=>{var e;return null!=(e=null==h?void 0:h.reduce((e,t)=>e+(0,g.SL)(t),0))?e:0},[h]),b=(0,s.useMemo)(()=>(n||[]).map(e=>e.content).join(" "),[n]),K=(0,r.F)(b,{skip:null==t||t})+L+S,j=(0,s.useMemo)(()=>{var e,t;let n=null==u?void 0:u.filter(e=>e.type===d.v8.GITHUB),i=null==u?void 0:u.filter(e=>e.type!==d.v8.GITHUB),r=null!=(e=null==n?void 0:n.map(e=>e.status.current_size_bytes).filter(e=>!!e&&"number"==typeof e).reduce((e,t)=>e+t,0))?e:0,a=null!=(t=null==i?void 0:i.map(e=>e.status.current_size_bytes).filter(e=>!!e&&"number"==typeof e).reduce((e,t)=>e+t,0))?t:0;return Math.floor(r/l.Pu+a/l.t2)},[u]);if(!i&&!a&&!c&&!y){if(t){var q;return null!=(q=null==v?void 0:v.knowledge_size)?q:0}return void 0!==n?void 0!==u?K+j:K:void 0!==u?j:void 0}},E=e=>{let t=C(),{data:n}=(0,p.fR)(e,t);if(n)return n.project_knowledge_search_threshold},k=e=>{let{mutate:t}=(0,_.sS)(e),{data:n}=(0,_.fo)(e);return()=>{t({is_starred:!(null==n?void 0:n.is_starred)})}},U=e=>{var t;let{projectUuid:n}=e,{account:i}=(0,u.YL)(),{data:r}=(0,_.fo)(n),{data:a}=(0,y.HP)(n),{value:l}=(0,o.fS)("claude_ai_constellation"),d=(null==a||null==(t=a.find(e=>e.account.uuid===(null==i?void 0:i.uuid)))?void 0:t.role)||"none",c=(null==r?void 0:r.creator.uuid)===(null==i?void 0:i.uuid),s=(null==a?void 0:a.some(e=>"user"===e.role&&e.account.uuid!==(null==r?void 0:r.creator.uuid)))||(null==r?void 0:r.is_private)===!1,v=!(null==r?void 0:r.is_private)&&(!l||(null==r?void 0:r.organization_role)==="user"),p=!(null==r?void 0:r.is_private)&&(!l||(null==r?void 0:r.organization_role)==="user"),f="user"===d||p;return{isCreator:c,isProjectShared:s,hasKBEditPermissions:"user"===d||v,canManageMembers:f,canEditRoleSelection:l&&f}}},80731:(e,t,n)=>{n.d(t,{K:()=>l,p:()=>o});var i=n(1761),r=n(55554),u=n(85544),a=n(21036);let l=()=>{let e=(0,i.O9)(),t=(0,i.zc)(),n=(0,i.mV)(),{selectedTier:l,shouldOverrideFeatureAccess:o,isTierSelectorEnabled:d}=(0,r.t)(),c=(0,a.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0,s=d&&o&&l?l===u.d7.PRO||l===u.d7.MAX||l===u.d7.ENTERPRISE:e||t||n,v=(0,a.useLayer)("trials_freemium").get("free_project",!1);return c||s||v},o=()=>{let e=(0,i.O9)(),t=(0,i.zc)(),n=(0,i.mV)(),{selectedTier:l,shouldOverrideFeatureAccess:o,isTierSelectorEnabled:d}=(0,r.t)(),c=(0,a.useDynamicConfig)("claude_ai_projects_limits"),s=(0,a.useLayer)("trials_freemium");if(d&&o&&l?l===u.d7.PRO||l===u.d7.MAX||l===u.d7.ENTERPRISE:e||t||n)return;let v=c.get("max_free_projects",0);return v>0?v:+!!s.get("free_project",!1)}},81527:(e,t,n)=>{n.d(t,{BN:()=>z,CB:()=>L,GQ:()=>T,Gz:()=>Q,Kf:()=>h,LQ:()=>C,PL:()=>g,bL:()=>K,bs:()=>S,dx:()=>f,eW:()=>q,fo:()=>b,gM:()=>m,gr:()=>_,sC:()=>y,sS:()=>j});var i=n(7726),r=n(77186),u=n(1761),a=n(29585),l=n(71473),o=n(27062),d=n(87606),c=n(37457),s=n.n(c),v=n(7620),p=n(80731);let y=30,f=1e4;var m=function(e){return e.Student="student",e.Beam="beam",e}({}),_=function(e){return e.Study="study",e.Career="career",e.Research="research",e.BeamTemplateAskClaudeV1="beam_template_ask_claude_v1",e}({});let g=()=>{let{activeOrganization:e}=(0,u.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[l.Wy,{orgUUID:t}],staleTime:3e5,enabled:!!t,meta:{noToast:e=>e instanceof a.LG&&"permission_error"===e.type}})},L=e=>{let{enabled:t=!0,limit:n,offset:i,starred:a,creatorFilter:d,isBeam:c,projectFilter:s}=e,{activeOrganization:v}=(0,u.YL)(),y=(0,p.K)(),f=(0,o.fS)("show-archived-projects"),m=null==v?void 0:v.uuid,_=new URLSearchParams;return _.append("include_harmony_projects","true"),void 0!==n&&_.append("limit",n.toString()),void 0!==i&&_.append("offset",i.toString()),void 0!==a&&_.append("starred",a.toString()),void 0!==d&&_.append("creator_filter",d.toString()),void 0!==c&&_.append("is_beam",c.toString()),void 0!==s&&_.append("filter",s.toString()),(0,r.Sk)("/api/organizations/".concat(m,"/projects?").concat(_.toString()),{queryKey:[l.BP,{orgUuid:m},{limit:n,offset:i,starred:a,creatorFilter:d,projectFilter:s,isBeam:c}],enabled:!!(t&&v&&y),select:e=>{let t=e.length===n;return Object.assign(f?e:e.filter(e=>!e.archived_at),{hasMore:t})}})},h=()=>{let{activeOrganization:e}=(0,u.YL)(),t=(0,r.mn)();return(0,v.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},S=()=>{let e=h(),t=(0,i.uE)();return(0,v.useCallback)(async()=>{let[n,r]=await Promise.all([e(),t({limit:i.dy})]);return((e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),i=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...i]})(n,r)},[t,e])},b=e=>{let{activeOrganization:t}=(0,u.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[l.hc,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof a.LG&&(404===e.statusCode||403===e.statusCode)}})},K=()=>{let{activeOrganization:e}=(0,u.YL)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[l.BP,{orgUuid:t}]})}})},j=e=>{let{activeOrganization:t}=(0,u.YL)(),n=null==t?void 0:t.uuid,i=Q();return(0,r.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{i(e)},queryKey:[l.hc,{orgUuid:n,projectUuid:e}]})},q=e=>{let{activeOrganization:t}=(0,u.YL)(),n=null==t?void 0:t.uuid,i=Q();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"DELETE",{onSuccess:()=>{i(e)}})},C=e=>{let{activeOrganization:t}=(0,u.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/projects/").concat(e,"/conversations"),{queryKey:[l.yF,{orgUuid:n,projectUuid:e}],enabled:!!t,staleTime:0,select:e=>s()(e,e=>new Date(e.updated_at)).reverse(),meta:{noToast:e=>e instanceof a.LG&&403===e.statusCode}})},z=()=>{var e,t;let n=L({enabled:!0,creatorFilter:"is_creator",limit:f}),i=null==(t=n.data)||null==(e=t.find(e=>e.is_starter_project))?void 0:e.uuid;return{...n,data:i}},Q=()=>{let{activeOrganization:e}=(0,u.YL)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[l.hc,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[l.BP,{orgUuid:t}]}),n.invalidateQueries({queryKey:[l.yF,{orgUuid:t,projectUuid:e}]})}},T=(e,t)=>(0,r.L2)("/api/organizations/".concat(e,"/projects/").concat(t,"/report"),"POST",{enabled:!!t&&!!e})},96784:(e,t,n)=>{n.d(t,{F:()=>u});var i=n(46612),r=n(7620);function u(e){let{skip:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[u,a]=(0,r.useState)(e.length/i.t2*.8),l=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!t){if(!l.current){if("undefined"==typeof Worker)return;try{let e=new Worker(n.tu(new URL(n.p+n.u(3572),n.b)));e.onmessage=e=>a(e.data),l.current=e}catch(t){var e;throw(null==t||null==(e=t.toString)?void 0:e.call(t).includes("Invalid URL"))&&console.error("useTokenCounter invalid URL error hit; baseUrl = ‘".concat("file:///app/packages/chat/utils/useTokenCounter.tsx","’")),t}}return()=>{var e;null==(e=l.current)||e.terminate(),l.current=null}}},[t]),(0,r.useEffect)(()=>{l.current&&l.current.postMessage(e)},[e]),u}}}]);