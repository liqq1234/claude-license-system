# æ•°æ®åº“è¡¨ç»“æ„é€»è¾‘åˆ†åŒºæ–¹æ¡ˆ

## ğŸ“Š é‡ç»„å‰åå¯¹æ¯”

### é‡ç»„å‰ï¼ˆæ··ä¹±çŠ¶æ€ï¼‰
```
license_server æ•°æ®åº“
â”œâ”€â”€ activation_batches          ï¼ˆæ¿€æ´»ç åŠŸèƒ½ï¼‰
â”œâ”€â”€ activation_codes            ï¼ˆæ¿€æ´»ç åŠŸèƒ½ï¼‰
â”œâ”€â”€ activation_logs             ï¼ˆæ¿€æ´»ç åŠŸèƒ½ï¼‰
â”œâ”€â”€ api_logs                    ï¼ˆç³»ç»ŸåŠŸèƒ½ï¼‰
â”œâ”€â”€ device_bindings             ï¼ˆæ¿€æ´»ç åŠŸèƒ½ï¼‰
â”œâ”€â”€ duration_options            ï¼ˆå¥—é¤åŠŸèƒ½ï¼‰
â”œâ”€â”€ email_verification_codes    ï¼ˆç”¨æˆ·åŠŸèƒ½ï¼‰
â”œâ”€â”€ operation_logs              ï¼ˆç³»ç»ŸåŠŸèƒ½ï¼‰
â”œâ”€â”€ orders                      ï¼ˆæ”¯ä»˜åŠŸèƒ½ï¼‰
â”œâ”€â”€ packages                    ï¼ˆå¥—é¤åŠŸèƒ½ï¼‰
â”œâ”€â”€ payment_methods             ï¼ˆæ”¯ä»˜åŠŸèƒ½ï¼‰
â”œâ”€â”€ proxy_sessions              ï¼ˆç³»ç»ŸåŠŸèƒ½ï¼‰
â”œâ”€â”€ subscription_types          ï¼ˆå¥—é¤åŠŸèƒ½ï¼‰
â”œâ”€â”€ token_pool                  ï¼ˆç³»ç»ŸåŠŸèƒ½ï¼‰
â”œâ”€â”€ usage_records               ï¼ˆæ¿€æ´»ç åŠŸèƒ½ï¼‰
â””â”€â”€ user_activation_bindings    ï¼ˆæ¿€æ´»ç åŠŸèƒ½ï¼‰
```

### é‡ç»„åï¼ˆé€»è¾‘åˆ†åŒºï¼‰
```
license_server æ•°æ®åº“
â”‚
â”œâ”€â”€ ğŸ“‹ æ¿€æ´»ç ç®¡ç†æ¨¡å— (LICENSE_)
â”‚   â”œâ”€â”€ license_activation_batches     æ¿€æ´»ç æ‰¹æ¬¡è¡¨
â”‚   â”œâ”€â”€ license_activation_codes       æ¿€æ´»ç ä¸»è¡¨
â”‚   â”œâ”€â”€ license_activation_logs        æ¿€æ´»æ—¥å¿—è¡¨
â”‚   â”œâ”€â”€ license_device_bindings        è®¾å¤‡ç»‘å®šè¡¨
â”‚   â”œâ”€â”€ license_user_bindings          ç”¨æˆ·æ¿€æ´»ç»‘å®šè¡¨
â”‚   â””â”€â”€ license_usage_records          ä½¿ç”¨è®°å½•è¡¨
â”‚
â”œâ”€â”€ ğŸ“¦ å¥—é¤ç®¡ç†æ¨¡å— (PACKAGE_)
â”‚   â”œâ”€â”€ package_subscription_types     å¥—é¤ç±»å‹è¡¨
â”‚   â”œâ”€â”€ package_duration_options       å¥—é¤æ—¶é•¿é…ç½®è¡¨
â”‚   â””â”€â”€ package_products               å¥—é¤äº§å“è¡¨
â”‚
â”œâ”€â”€ ğŸ’° æ”¯ä»˜ç®¡ç†æ¨¡å— (PAYMENT_)
â”‚   â”œâ”€â”€ payment_methods                æ”¯ä»˜æ–¹å¼è¡¨
â”‚   â””â”€â”€ payment_orders                 è®¢å•è¡¨
â”‚
â”œâ”€â”€ âš™ï¸ ç³»ç»Ÿç®¡ç†æ¨¡å— (SYSTEM_)
â”‚   â”œâ”€â”€ system_api_logs                APIè°ƒç”¨æ—¥å¿—è¡¨
â”‚   â”œâ”€â”€ system_operation_logs          æ“ä½œæ—¥å¿—è¡¨
â”‚   â”œâ”€â”€ system_proxy_sessions          ä»£ç†ä¼šè¯è¡¨
â”‚   â””â”€â”€ system_token_pool              ä»¤ç‰Œæ± è¡¨
â”‚
â””â”€â”€ ğŸ‘¤ ç”¨æˆ·ç®¡ç†æ¨¡å— (USER_)
    â””â”€â”€ user_email_verification_codes  é‚®ç®±éªŒè¯ç è¡¨
```

## ğŸ”„ æ‰§è¡Œé‡ç»„çš„æ­¥éª¤

### 1. å¤‡ä»½ç°æœ‰æ•°æ®
```sql
-- åˆ›å»ºæ•°æ®åº“å¤‡ä»½
mysqldump -u root -p license_server > license_server_backup_20250903.sql
```

### 2. æ‰§è¡Œè¡¨é‡å‘½å
```bash
mysql -u root -p license_server < database/reorganize_tables.sql
```

### 3. æ›´æ–°ä»£ç ä¸­çš„è¡¨åå¼•ç”¨
éœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ä¸­çš„è¡¨åï¼š
- `src/routes/*.js` (æ‰€æœ‰è·¯ç”±æ–‡ä»¶)
- `src/models/*.js` (å¦‚æœæœ‰æ¨¡å‹æ–‡ä»¶)
- `src/services/*.js` (æœåŠ¡æ–‡ä»¶)

### 4. åˆ›å»ºå…¼å®¹æ€§è§†å›¾
ä¸ºäº†ä¸å½±å“ç°æœ‰ä»£ç ï¼Œå·²åœ¨è„šæœ¬ä¸­åˆ›å»ºäº†è§†å›¾æ˜ å°„ï¼š
- `activation_codes` â†’ `license_activation_codes`
- `packages` â†’ `package_products`
- `orders` â†’ `payment_orders`
- ç­‰ç­‰...

## ğŸ¯ é€»è¾‘åˆ†åŒºçš„å¥½å¤„

### 1. **å¯è¯»æ€§æå‡**
- è¡¨åä¸€ç›®äº†ç„¶ï¼ŒçŸ¥é“åŠŸèƒ½å½’å±
- ä¾¿äºæ–°äººå¿«é€Ÿç†è§£ç³»ç»Ÿæ¶æ„

### 2. **ç»´æŠ¤æ€§å¢å¼º**
- æ¨¡å—åŒ–ç®¡ç†ï¼Œä¿®æ”¹æŸä¸ªåŠŸèƒ½æ—¶èŒƒå›´æ˜ç¡®
- ä¾¿äºæ•°æ®åº“æƒé™åˆ†é…å’Œè®¿é—®æ§åˆ¶

### 3. **æ‰©å±•æ€§æ›´å¥½**
- æ–°å¢åŠŸèƒ½æ—¶ï¼ŒæŒ‰æ¨¡å—åˆ›å»ºè¡¨
- ä¾¿äºåæœŸæ‹†åˆ†å¾®æœåŠ¡

### 4. **å›¢é˜Ÿåä½œ**
- ä¸åŒå¼€å‘è€…è´Ÿè´£ä¸åŒæ¨¡å—
- å‡å°‘è¡¨åå†²çªå’Œæ··æ·†

## ğŸ“ ä»£ç ä¿®æ”¹å»ºè®®

### æ›´æ–°APIè·¯ç”±æ–‡ä»¶
```javascript
// ä¹‹å‰
SELECT * FROM packages WHERE id = ?

// ä¹‹å
SELECT * FROM package_products WHERE id = ?
```

### æ¸è¿›å¼è¿ç§»
1. å…ˆæ‰§è¡Œé‡å‘½åè„šæœ¬ï¼ˆåˆ›å»ºè§†å›¾ä¿è¯å…¼å®¹æ€§ï¼‰
2. é€æ­¥æ›´æ–°ä»£ç ä½¿ç”¨æ–°è¡¨å
3. æœ€ååˆ é™¤å…¼å®¹æ€§è§†å›¾

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºæ¯ä¸ªæ¨¡å—çš„å¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
2. **åˆ†è¡¨ç­–ç•¥**: å¯¹äºæ—¥å¿—ç±»è¡¨è€ƒè™‘æŒ‰æ—¶é—´åˆ†è¡¨
3. **è¯»å†™åˆ†ç¦»**: æ—¥å¿—è¡¨å¯ä»¥è€ƒè™‘å•ç‹¬çš„åªè¯»å‰¯æœ¬
4. **æ•°æ®å½’æ¡£**: å®šæœŸå½’æ¡£å†å²æ•°æ®
